# AlphaQuant - çœŸå®æ•°æ®è®­ç»ƒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`train_real_data.py` æ˜¯ AlphaQuant çš„çœŸå®æ•°æ®è®­ç»ƒè„šæœ¬ï¼Œæ”¯æŒä» Tushare Pro API åŠ è½½çœŸå®å¸‚åœºæ•°æ®è¿›è¡Œè®­ç»ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd /root/clawd/AlphaGPT
pip install tushare pandas numpy torch loguru tqdm
```

### 2. é…ç½® Tushare Token

ä» https://tushare.pro è·å– API Tokenï¼Œç„¶åè®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export TUSHARE_TOKEN=your_token_here
```

æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```env
TUSHARE_TOKEN=cc9f4227a4be5c67699791c24526d2ec3947877f1cec3619866078f4
```

### 3. è¿è¡Œè®­ç»ƒ

#### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤è‚¡ç¥¨æ± è®­ç»ƒ
python train_real_data.py \
    --start-date 2023-01-01 \
    --end-date 2024-12-31 \
    --epochs 100 \
    --batch-size 32
```

#### æŒ‡å®šè‚¡ç¥¨æ± 

```bash
python train_real_data.py \
    --stocks 600000,600519,000001,000002 \
    --start-date 2023-01-01 \
    --end-date 2024-12-31 \
    --epochs 100
```

#### ä½¿ç”¨ CPU

```bash
python train_real_data.py \
    --device cpu \
    --epochs 50
```

#### ç¦ç”¨ç¼“å­˜ï¼ˆé‡æ–°ä¸‹è½½ï¼‰

```bash
python train_real_data.py \
    --no-cache \
    --cache-dir ./cache_fresh
```

## ğŸ“Š è®­ç»ƒå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|--------|------|
| `--token` | ç¯å¢ƒå˜é‡ | Tushare API Token |
| `--stocks` | 1,2,3,600000,600519 | è‚¡ç¥¨ä»£ç åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| `--start-date` | 2023-01-01 | å¼€å§‹æ—¥æœŸ |
| `--end-date` | 2024-12-31 | ç»“æŸæ—¥æœŸ |
| `--epochs` | 100 | è®­ç»ƒè½®æ•° |
| `--batch-size` | 32 | æ‰¹é‡å¤§å° |
| `--lr` | 1e-4 | å­¦ä¹ ç‡ |
| `--device` | cuda | è®¾å¤‡ (cuda/cpu) |
| `--save-dir` | ./checkpoints_real | æ¨¡å‹ä¿å­˜ç›®å½• |
| `--cache-dir` | ./cache_real | æ•°æ®ç¼“å­˜ç›®å½• |
| `--no-cache` | False | ç¦ç”¨ç¼“å­˜ |

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. çœŸå®æ•°æ®åŠ è½½
- ä» Tushare Pro API åŠ è½½çœŸå®å¸‚åœºæ•°æ®
- æ”¯æŒå¤šè‚¡ç¥¨å¹¶è¡ŒåŠ è½½
- è‡ªåŠ¨æ•°æ®éªŒè¯å’Œæ¸…æ´—

### 2. æŠ€æœ¯å› å­è®¡ç®—
- ä½¿ç”¨ ChinaFactorEngine è®¡ç®—æŠ€æœ¯å› å­
- åŒ…å«åŠ¨é‡ã€å‡å€¼å›å½’ã€æ³¢åŠ¨ç‡ç­‰å› å­
- å½’ä¸€åŒ–å¤„ç†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 3. ç¼“å­˜æœºåˆ¶
- è‡ªåŠ¨ç¼“å­˜åŠ è½½çš„æ•°æ®ï¼Œé¿å…é‡å¤è¯·æ±‚
- æ”¯æŒç¼“å­˜ç¦ç”¨é€‰é¡¹
- æå‡è®­ç»ƒæ•ˆç‡

### 4. æ•°æ®æ¸…æ´—
- å»é™¤é‡å¤æ•°æ®
- å¡«å……ç¼ºå¤±å€¼ï¼ˆå‰å‘ + åå‘å¡«å……ï¼‰
- æ•°æ®æ’åºå’ŒéªŒè¯

### 5. ç›®æ ‡è®¡ç®—
- **æœªæ¥æ”¶ç›Š**: æœªæ¥ 5 æ—¥ç´¯è®¡æ”¶ç›Š
- **å¤æ™®æ¯”ç‡**: æœªæ¥ 20 æ—¥é£é™©è°ƒæ•´æ”¶ç›Š
- **æœ€å¤§å›æ’¤**: æœªæ¥ 20 æ—¥æœ€å¤§å›æ’¤

### 6. æ—©åœæœºåˆ¶
- è‡ªåŠ¨æ£€æµ‹éªŒè¯æŸå¤±åœæ­¢æ”¹å–„
- é¿å…è¿‡æ‹Ÿåˆ
- èŠ‚çœè®­ç»ƒæ—¶é—´

### 7. é£é™©è°ƒæ•´æŸå¤±
- æƒ©ç½šé¢„æµ‹ä¸ºæ­£ä½†å®é™…ä¸ºè´Ÿçš„æƒ…å†µ
- é™ä½æ¨¡å‹é£é™©

## ğŸ“ˆ è®­ç»ƒç›‘æ§

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºä»¥ä¸‹æŒ‡æ ‡ï¼š

```
Epoch 1/100
Train Loss: 0.0123, Val Loss: 0.0156
Correlation: 0.2345
âœ… Saved best model (val_loss: 0.0156)
```

- **Train Loss**: è®­ç»ƒé›†æŸå¤±
- **Val Loss**: éªŒè¯é›†æŸå¤±
- **Correlation**: é¢„æµ‹å€¼ä¸çœŸå®å€¼çš„ç›¸å…³æ€§

## ğŸ’¾ æ¨¡å‹ä¿å­˜

æœ€ä½³æ¨¡å‹ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `checkpoints_real/` ç›®å½•ï¼š

```
best_model_realdata_epoch23.pt
```

åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- æ¨¡å‹æƒé‡
- ä¼˜åŒ–å™¨çŠ¶æ€
- å­¦ä¹ ç‡è°ƒåº¦å™¨çŠ¶æ€
- éªŒè¯æŸå¤±å’Œç›¸å…³æ€§

## ğŸ”„ åŠ è½½å·²è®­ç»ƒæ¨¡å‹

```python
from alphaquant.model.alpha_quant import AlphaQuant, ModelConfig
import torch

# åŠ è½½æ£€æŸ¥ç‚¹
checkpoint = torch.load('checkpoints_real/best_model_realdata_epoch23.pt')

# é‡å»ºæ¨¡å‹
config = checkpoint['config']
model = AlphaQuant(config).to('cuda')
model.load_state_dict(checkpoint['model_state_dict'])
model.eval()

# ä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹
...
```

## ğŸ“ ç¤ºä¾‹è‚¡ç¥¨æ± 

### è“ç­¹è‚¡
```
--stocks 600000,600519,000001,000002,600036
```

### ç§‘æŠ€è‚¡
```
--stocks 600036,600030,601318,601398,000858
```

### æ¶ˆè´¹è‚¡
```
--stocks 600519,000858,600887,000333,002415
```

### å…¨ A è‚¡ï¼ˆå‰ 100ï¼‰
```
--stocks 1,2,3,4,5,6,600000,600004,600006,600007,600008,600009,600010,600011,600012,600015,600016,600017,600018,600019,600020,600021,600022,600023,600025,600026,600027,600028,600029,600030,600031,600033,600035,600036,600037,600038,600039,600048,600050,600051,600052,600053,600054,600055,600056,600058,600059,600060,600061,600062,600063,600064,600066,600067,600068,600069,600070,600071,600072,600073,600074,600075,600076,600077,600078,600079,600080,600081,600082,600083,600084,600085,600086,600087,600088,600089,600090,600091,600092,600093,600094,600095,600096,600097,600098,600099,600100
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API é™åˆ¶**: Tushare æœ‰å¹¶å‘å’Œé¢‘ç‡é™åˆ¶ï¼Œé¿å…çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚
2. **æ•°æ®è´¨é‡**: ç¡®ä¿è‚¡ç¥¨ä»£ç æ­£ç¡®ï¼Œéƒ¨åˆ†è‚¡ç¥¨å¯èƒ½å› é€€å¸‚ç­‰åŸå› æ•°æ®ç¼ºå¤±
3. **ç¼“å­˜ç®¡ç†**: é•¿æ—¶é—´è¿è¡Œåå¯èƒ½éœ€è¦æ¸…ç†ç¼“å­˜ç›®å½•
4. **å†…å­˜ä½¿ç”¨**: åŠ è½½å¤šåªè‚¡ç¥¨æ•°æ®æ—¶æ³¨æ„å†…å­˜å ç”¨
5. **è®­ç»ƒæ—¶é—´**: çœŸå®æ•°æ®è®­ç»ƒå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®ä½¿ç”¨ GPU

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜: åŠ è½½å¤±è´¥ï¼Œæç¤º Insufficient data
**è§£å†³**: æ£€æŸ¥è‚¡ç¥¨ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œæˆ–è°ƒæ•´æ—¥æœŸèŒƒå›´

### é—®é¢˜: Tushare API è¿”å› 403
**è§£å†³**: æ£€æŸ¥ Token æ˜¯å¦æœ‰æ•ˆï¼Œç§¯åˆ†æ˜¯å¦å……è¶³

### é—®é¢˜: è®­ç»ƒæ—¶ CUDA out of memory
**è§£å†³**: å‡å° `batch-size` æˆ–ä½¿ç”¨ `--device cpu`

### é—®é¢˜: è®­ç»ƒå¤ªæ…¢
**è§£å†³**: å‡å°‘è‚¡ç¥¨æ•°é‡ï¼Œæˆ–ä½¿ç”¨æ›´å¤§çš„ `batch-size`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [train_model.py](train_model.py) - åˆæˆæ•°æ®è®­ç»ƒè„šæœ¬
- [alphaquant/model/alpha_quant.py](alphaquant/model/alpha_quant.py) - æ¨¡å‹å®šä¹‰
- [alphaquant/data_providers/tushare.py](alphaquant/data_providers/tushare.py) - Tushare æ•°æ®æä¾›è€…
- [alphaquant/factors/china_factors.py](alphaquant/factors/china_factors.py) - å› å­å¼•æ“

---

**æ›´æ–°æ—¶é—´**: 2026-02-03
**ä½œè€…**: ä¸Šç­‰å…µâ€¢ç”˜
